class Table{constructor(e,t){this.table=e,this.parentInstance=t,this.thead=e.querySelector("thead"),this.tbody=e.querySelector("tbody"),this.headers=[],this.thead&&(this.headers=Array.from(this.thead.querySelectorAll("th"))),this.rows=Array.from(this.tbody.querySelectorAll("tr")),this.filteredRows=[...this.rows],this.rowsPerPage=parseInt(e.getAttribute(this.parentInstance.rowsPerPageAttribute)??this.parentInstance.rowsPerPage),this.currentPage=this.parentInstance.currentPage,this.checkAllCheckBox=null,this.searchInput=null,this.pagination=null,this.paginationInfo=null,this.filters=[],this.rangeFilters=[],this.itemNotFoundMessage="Nothing found.",this.deleteRowMessage="Are you sure you want to delete this row?",this.deleteMultipleRowsMessage="Are you sure you want to delete these rows?"}get totalPages(){return Math.ceil(this.filteredRows.length/this.rowsPerPage)||1}init(){this.setupCheckAll(),this.setupCheckboxListeners(),this.setupSearch(),0<this.headers.length&&(this.setupFilters(),this.setupSort()),this.setupRowsPerPage(),this.setupPagination(),this.setupPaginationInfo(),this.deleteSelected(),this.deleteRow(),this.update()}setupCheckAll(){this.thead&&(this.checkAllCheckBox=this.thead.querySelector(this.parentInstance.checkAllSelector),this.checkAllCheckBox)&&this.checkAllCheckBox.addEventListener("click",t=>{var e=this.rows.map(e=>e.querySelector('input[type="checkbox"]'));e&&0<e.length&&e.forEach(e=>e.checked=t.target.checked)})}setupCheckboxListeners(){let t=this.table.querySelectorAll('input[type="checkbox"]');this.checkAllCheckBox&&0<t.length&&t.forEach(e=>{e.addEventListener("change",()=>{var e=Array.from(t).some(e=>e.checked);this.deleteSelectedSelector&&0<this.filteredRows.length&&this.deleteSelectedSelector.classList.toggle("d-none",!e)})})}setupSearch(){this.searchInput=this.table.querySelector(this.parentInstance.searchSelector),this.searchInput&&this.searchInput.addEventListener("keyup",e=>{let t=e.target.value.toLowerCase();this.filteredRows=this.rows.filter(e=>Array.from(e.querySelectorAll("td")).some(e=>e.textContent.toLowerCase().includes(t))),this.currentPage=1,this.update()})}setupFilters(){this.filters=Array.from(this.table.querySelectorAll(this.parentInstance.filterSelector)),this.filters.forEach(e=>{e.addEventListener("change",()=>{this.applyFilters(),this.currentPage=1,this.update()})}),this.rangeFilters=Array.from(this.table.querySelectorAll(this.parentInstance.rangeFilterSelector)),this.rangeFilters.forEach(e=>{e.addEventListener("change",()=>{this.applyFilters(),this.currentPage=1,this.update()})})}applyFilters(){let t=r=>this.filters.every(e=>{var t=e.value;if(!t||"All"===t)return!0;let a=e.dataset.tableFilter;var e=this.headers.findIndex(e=>e.dataset.column===a);return-1===e||!(e=r.children[e])||e.textContent.trim().toLowerCase()===t.toLowerCase()}),a=c=>this.rangeFilters.every(a=>{var r=a.value;if(!r||"All"===r)return!0;let t=a.dataset.tableRangeFilter;a=this.headers.findIndex(e=>e.dataset.column===t);if(-1===a)return!0;a=c.children[a];if(!a)return!0;var e,s,i,a=a.textContent.trim();if(!t.toLowerCase().includes("date"))return e=parseFloat(a.replace(/[^\d.-]/g,"")),!isNaN(e)&&(r.endsWith("+")?parseFloat(r.slice(0,-1))<=e:([s,i]=r.split("-").map(e=>parseFloat(e.trim())),!isNaN(s)&&!isNaN(i)&&s<=e&&e<=i));{var n=new Date(a);if(isNaN(n.getTime()))return!1;var l=new Date,o=new Date(l.getFullYear(),l.getMonth(),l.getDate()),h=new Date(l.getFullYear(),l.getMonth(),l.getDate()+1);let e,t;switch(r){case"Today":return o<=n&&n<h;case"Last 7 Days":return(e=new Date(l)).setDate(l.getDate()-7),t=h,n>=e&&n<t;case"Last 30 Days":return(e=new Date(l)).setDate(l.getDate()-30),t=h,n>=e&&n<t;case"This Year":return e=new Date(l.getFullYear(),0,1),t=new Date(l.getFullYear()+1,0,1),n>=e&&n<t;default:return!0}}});this.filteredRows=this.rows.filter(e=>t(e)&&a(e))}setupRowsPerPage(){let a=this.table.querySelector(this.parentInstance.rowsPerPageSelector);var e;a&&((e=Array.from(a.options).map(e=>parseInt(e.value))).includes(this.rowsPerPage)||e.push(this.rowsPerPage),e.sort((e,t)=>e-t),a.innerHTML="",e.forEach(e=>{var t=document.createElement("option");t.value=e.toString(),t.textContent=e.toString(),a.appendChild(t)}),a.value=this.rowsPerPage,a.addEventListener("change",e=>{e.preventDefault(),this.rowsPerPage=parseInt(e.target.value),this.update()}))}setupPagination(){this.pagination=this.table.querySelector(this.parentInstance.paginationSelector)}renderTablePage(e){this.tbody.innerHTML="";var t,e=(e-1)*this.rowsPerPage,a=e+this.rowsPerPage,e=this.filteredRows.slice(e,a),a=this.tbody.querySelector(".no-results");a&&a.remove(),0===e.length?(a=this.table.querySelectorAll("thead th").length,(t=document.createElement("tr")).className="no-results",t.innerHTML=`<td colspan="${a}" class="text-center text-muted py-3">${this.itemNotFoundMessage}</td>`,this.tbody.appendChild(t)):e.forEach(e=>{this.tbody.appendChild(e)})}renderPagination(){var e=document.createElement("ul"),a=(e.className="pagination pagination-sm pagination-boxed mb-0 justify-content-center",this.pagination.innerHTML="",this.totalPages),t=document.createElement("li");t.className="page-item "+(1===this.currentPage?"disabled":""),t.innerHTML='<a href="#" class="page-link"><svg  xmlns="http://www.w3.org/2000/svg"  width="16"  height="16"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 6l-6 6l6 6" /></svg></a>',t.addEventListener("click",e=>{e.preventDefault(),1<this.currentPage&&(this.currentPage--,this.update())}),e.appendChild(t);for(let t=1;t<=a;t++){var r=document.createElement("li");r.className="page-item "+(this.currentPage===t?"active":""),r.innerHTML=`<a href="#" class="page-link">${t}</a>`,r.addEventListener("click",e=>{e.preventDefault(),this.currentPage=t,this.update()}),e.appendChild(r)}t=document.createElement("li");t.className="page-item "+(this.currentPage===a?"disabled":""),t.innerHTML='<a href="#" class="page-link"><svg  xmlns="http://www.w3.org/2000/svg"  width="16"  height="16"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 6l6 6l-6 6" /></svg></a>',t.addEventListener("click",e=>{e.preventDefault(),this.currentPage<this.totalPages&&(this.currentPage++,this.update())}),e.appendChild(t),this.pagination.appendChild(e),this.setupPaginationInfo()}setupPaginationInfo(){var e,t,a;this.paginationInfo=this.table.querySelector(this.parentInstance.paginationInfoSelector),this.paginationInfo&&(this.paginationInfo.className="text-muted",e=this.paginationInfo.getAttribute(this.parentInstance.paginationInfoAttribute),t=(this.currentPage-1)*this.rowsPerPage+1,a=Math.min(this.currentPage*this.rowsPerPage,this.filteredRows.length),this.paginationInfo.innerHTML=`Showing <span class="fw-semibold">${t}</span> to <span class="fw-semibold">${a}</span> of <span class="fw-semibold">${this.filteredRows.length}</span> `+(e&&""!==e?e:"entries"))}update(){var e;this.renderTablePage(this.currentPage),this.pagination&&(e=0<this.filteredRows.length,this.pagination.style.display=e?"block":"none",this.paginationInfo&&(this.paginationInfo.style.display=e?"block":"none"),e)&&this.renderPagination()}setupSort(){this.table.querySelectorAll(this.parentInstance.sortSelector).forEach(t=>{t.style.cursor="pointer";let n=t.querySelector("i");n||((n=document.createElement("span")).innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="ms-1">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M3 9l4 -4l4 4m-4 -4v14" />
          <path d="M21 15l-4 4l-4 -4m4 4v-14" />
        </svg>`,t.appendChild(n)),t.addEventListener("click",e=>{e.preventDefault();let s=Array.from(t.parentElement.children).indexOf(t);if(-1!==s){let a=t.getAttribute(this.parentInstance.sortAttribute);let r="asc"===t.dataset.direction?"desc":"asc";function i(t,a,r){t=t.children[a];if(!t)return"";let e="";r=(e=(e=r?(a=t.querySelector(`[data-sort="${r}"]`))?a.textContent.trim():"":(Array.from(t.childNodes).find(e=>e.nodeType===Node.TEXT_NODE&&e.textContent.trim())||t).textContent.trim()).replace(/\s+/g," ")).match(/^\(([\d,.\s]+)\)$/);if(r)return a=parseFloat(r[1].replace(/,/g,"")),isNaN(a)?e.toLowerCase():-a;if(/^-?[\d,.]+%$/.test(e))return t=parseFloat(e.replace("%","")),isNaN(t)?0:t/100;r=e.match(/^-?[\$€₹]?\s*([\d,.]+)\s*([KMB])?$/i);if(r){let e=parseFloat(r[1].replace(/,/g,""));a=r[2]?.toUpperCase(),t={K:1e3,M:1e6,B:1e9};if(!isNaN(e))return a&&t[a]&&(e*=t[a]),e}r=e.match(/^(\d+)(st|nd|rd|th)$/i);return r?parseInt(r[1],10):/^-?\d+(\.\d+)?$/.test(e)?(t=parseFloat(e),isNaN(t)?e.toLowerCase():t):(a=new Date(e),isNaN(a.getTime())?e.toLowerCase():a.getTime())}"asc"==(t.dataset.direction=r)?n.innerHTML='<svg  xmlns="http://www.w3.org/2000/svg"  width="13"  height="13"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="ms-1"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M16 9l-4 -4" /><path d="M8 9l4 -4" /></svg>':n.innerHTML='<svg  xmlns="http://www.w3.org/2000/svg"  width="13"  height="13"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="ms-1"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M16 15l-4 4" /><path d="M8 15l4 4" /></svg>',this.filteredRows.sort((e,t)=>{e=i(e,s,a),t=i(t,s,a);return"number"==typeof e&&"number"==typeof t?"asc"==r?e-t:t-e:"string"==typeof e&&"string"==typeof t?"asc"==r?e.localeCompare(t):t.localeCompare(e):0}),this.currentPage=1,this.update()}})})}deleteSelected(){this.deleteSelectedSelector=this.table.querySelector(this.parentInstance.deleteSelectedSelector),this.deleteSelectedSelector&&this.deleteSelectedSelector.addEventListener("click",e=>{e.preventDefault();let r=this.rows.filter(e=>e.querySelector('input[type="checkbox"]').checked);if(0<r.length){let{modal:t,confirmButton:e}=this.alert(1<r.length?this.deleteMultipleRowsMessage:this.deleteRowMessage),a=this.rows;t.show(),e.addEventListener("click",()=>{r.forEach(e=>e.remove());var e=a.filter(e=>!r.includes(e));this.rows=[...e],this.filteredRows=[...e],this.currentPage>this.totalPages&&(this.currentPage=this.totalPages),this.update(),t.hide(),this.deleteSelectedSelector.classList.add("d-none"),this.checkAllCheckBox.checked=!1})}})}deleteRow(){var e=this.table.querySelectorAll(this.parentInstance.deleteRowSelector);e&&e.forEach(s=>{s.addEventListener("click",e=>{e.preventDefault();let{modal:a,confirmButton:t}=this.alert(),r=this.rows;a.show(),t.addEventListener("click",()=>{let t=s.closest("tr");t.remove();var e=r.filter(e=>e!==t);this.rows=[...e],this.filteredRows=[...e],this.currentPage>this.totalPages&&(this.currentPage=this.totalPages),this.update(),a.hide()})})})}alert(e){var t,e=`
        <div id="confirm-delete-modal" class="modal fade" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Confirm Deletion</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">   
                        <p class="mb-0">${e??this.deleteRowMessage}</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                          <button type="button" class="btn btn-danger" id="confirm-delete">Delete</button>
                    </div>
                </div>
            </div>
        </div>`,e=(document.body.insertAdjacentHTML("beforeend",e),document.getElementById("confirm-delete-modal"));return e&&(t=new bootstrap.Modal(e),e=e.querySelector("#confirm-delete"))?{modal:t,confirmButton:e}:(console.error("CustomTable: Elements not found."),{modal:null,confirmButton:null})}}class CustomTable{constructor({tableSelector:e="[data-table]",checkAllSelector:t="[data-table-select-all]",searchSelector:a="[data-table-search]",filterSelector:r="select[data-table-filter], input[data-table-filter]",rangeFilterSelector:s="select[data-table-range-filter], input[data-table-range-filter]",rowsPerPageSelector:i="[data-table-set-rows-per-page]",rowsPerPageAttribute:n="data-table-rows-per-page",paginationSelector:l="[data-table-pagination]",sortSelector:o="[data-table-sort]",sortAttribute:h="data-table-sort",paginationInfoSelector:c="[data-table-pagination-info]",paginationInfoAttribute:d="data-table-pagination-info",deleteSelectedSelector:u="[data-table-delete-selected]",deleteRowSelector:p="[data-table-delete-row]",rowsPerPage:g=10,currentPage:f=1}={}){this.tableSelector=e,this.checkAllSelector=t,this.searchSelector=a,this.filterSelector=r,this.rangeFilterSelector=s,this.rowsPerPageSelector=i,this.rowsPerPageAttribute=n,this.paginationSelector=l,this.sortSelector=o,this.sortAttribute=h,this.paginationInfoSelector=c,this.paginationInfoAttribute=d,this.deleteSelectedSelector=u,this.deleteRowSelector=p,this.rowsPerPage=g,this.currentPage=f,this.tables=[],this.init()}init(){var e=document.querySelectorAll(this.tableSelector);0===e.length?console.error("CustomTable: No elements found for selector "+this.tableSelector):e.forEach(e=>{e=new Table(e,this);this.tables.push(e),e.init()})}}document.addEventListener("DOMContentLoaded",()=>{new CustomTable});